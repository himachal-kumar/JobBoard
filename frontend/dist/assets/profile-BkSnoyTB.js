import{u as D,j as e,B as r,y as k,z as I,f as a,E as N,g as F,l as H,k as h,C as L,K as B}from"./mui-aM5Ef8QJ.js";import{c as O,o as $}from"./createStyles-DgF961df.js";import{u as R,c as V,a as x,b as K}from"./forms-C2kV68VR.js";import{c as Q,d as G,e as J,B as A,u as X,f as Y}from"./index-D7JtJ2Ea.js";import{P as S}from"./PasswordInput-Dp6CrQEg.js";import"./vendor-YL3_wyph.js";import"./routing-CPJpXWUM.js";import"./state-Cg_04vs9.js";const Z=V({currentPassword:x().nullable(),password:x().required("Password is required").min(5,"Minimum 5 characters are required").max(16,"Maximum 16 characters allowed"),confirmPassword:x().oneOf([K("password")],"Passwords must match").required("Confirm password is required")}),_=o=>O({root:{maxWidth:400,flex:1,mx:"auto"},input:{mt:2},button:{my:2},link:{color:o.palette.primary.main}});function ee(o){var p,f,g,w,j,y;const s=D(),t=_(s),c=Q(),{provider:n}=o.user,[i,{isLoading:m}]=G(),{register:u,handleSubmit:T,reset:U,formState:{errors:l,isValid:E}}=R({defaultValues:{confirmPassword:"",password:"",currentPassword:""},resolver:$(Z)}),M=async q=>{var b,v,P,C,W;try{await i(q).unwrap(),c(J.util.invalidateTags(["ME"])),U(),A.success("Password changed successfully!")}catch(d){const z=(C=(P=(v=(b=d==null?void 0:d.data)==null?void 0:b.data)==null?void 0:v.errors)==null?void 0:P[0])==null?void 0:C.msg;A.error(z??((W=d==null?void 0:d.data)==null?void 0:W.message)??"Something went wrong!")}};return e.jsx(r,{display:"flex",justifyContent:"center",alignItems:"center",maxWidth:500,mx:"auto",children:e.jsx(k,{sx:{width:"100%",maxWidth:400},children:e.jsxs(I,{sx:{p:4},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,textAlign:"center",mb:3,children:"Change Password"}),e.jsxs(r,{component:"form",onSubmit:T(M),children:[n==="manual"&&e.jsx(N,{sx:t.input,fullWidth:!0,type:"password",placeholder:"Current password",label:"Current password",...u("currentPassword"),error:!!((p=l.currentPassword)!=null&&p.message),helperText:(f=l.currentPassword)==null?void 0:f.message}),e.jsx(S,{sx:t.input,fullWidth:!0,type:"password",placeholder:"New password",label:"New password",error:!!((g=l.password)!=null&&g.message),helperText:(w=l.password)==null?void 0:w.message,...u("password")}),e.jsx(S,{sx:t.input,fullWidth:!0,type:"password",placeholder:"Confirm password",label:"Confirm password",error:!!((j=l.confirmPassword)!=null&&j.message),helperText:(y=l.confirmPassword)==null?void 0:y.message,...u("confirmPassword")}),e.jsx(F,{type:"submit",sx:t.button,variant:"contained",fullWidth:!0,disabled:!E||m,children:m?"Changing Password...":"Change Password"})]})]})})})}function re(o){const{name:s,email:t,role:c,image:n,active:i,blocked:m}=o.data;return e.jsx(r,{children:e.jsx(k,{sx:{maxWidth:500,mx:"auto",mt:4,mb:4},children:e.jsx(I,{sx:{p:4},children:e.jsx(r,{children:e.jsxs(r,{display:"flex",alignItems:"center",flexWrap:"wrap",gap:2,children:[e.jsx(H,{alt:s||"User",sx:{width:100,height:100},children:n?e.jsx(r,{component:"img",src:n,sx:{width:100,height:100,objectFit:"cover"},alt:s||"User"}):e.jsx(a,{variant:"h4",children:(s||"U").charAt(0).toUpperCase()})}),e.jsxs(r,{flex:1,minWidth:200,children:[e.jsx(a,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:s||"No Name"}),e.jsx(a,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:t||"No Email"}),e.jsxs(r,{display:"flex",gap:1,flexWrap:"wrap",mt:1,children:[e.jsx(h,{label:c||"USER",color:"default",size:"small"}),i!==void 0&&e.jsx(h,{label:i?"Active":"Inactive",color:i?"success":"error",size:"small"}),m&&e.jsx(h,{label:"Blocked",color:"error",size:"small"})]})]})]})})})})})}const ce=()=>{const{isAuthenticated:o}=X(i=>i.auth),{data:s,isLoading:t,error:c,refetch:n}=Y(void 0,{skip:!o,refetchOnMountOrArgChange:!0});return t?e.jsxs(r,{width:"100%",minHeight:"50vh",padding:5,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",children:[e.jsx(L,{size:60}),e.jsx(a,{variant:"h6",sx:{mt:2},children:"Loading profile..."})]}):c?e.jsxs(r,{width:"100%",minHeight:"50vh",padding:5,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",children:[e.jsx(B,{severity:"error",sx:{mb:2,maxWidth:500},children:"Failed to load profile data. Please try again."}),e.jsx(a,{variant:"body1",color:"text.secondary",sx:{mb:2}}),e.jsx(r,{children:e.jsx(a,{variant:"body2",color:"primary",sx:{cursor:"pointer",textDecoration:"underline"},onClick:()=>n(),children:"Click here to retry"})})]}):s!=null&&s.data?e.jsxs(r,{sx:{py:3},children:[e.jsx(re,{data:s.data}),e.jsx(ee,{user:s.data})]}):e.jsxs(r,{width:"100%",minHeight:"50vh",padding:5,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",children:[e.jsx(B,{severity:"warning",sx:{mb:2,maxWidth:500},children:"Profile not found!"}),e.jsx(a,{variant:"body1",color:"text.secondary",children:"Unable to retrieve your profile information."})]})};export{ce as default};
